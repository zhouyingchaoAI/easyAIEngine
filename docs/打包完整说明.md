# 完整打包说明

## 问题说明

如果只打包了 `algorithm_manager.py`，会出现以下问题：
- `algorithm_manager` 无法启动 `algorithm_service.py`（文件不存在）
- 缺少依赖的 Python 服务文件

## 解决方案

需要打包所有服务文件，包括：
1. `algorithm_manager.py` → `algorithm_manager`（管理器）
2. `algorithm_service.py` → `algorithm_service`（实时检测服务）
3. `algorithm_service_line_crossing.py` → `algorithm_service_line_crossing`（绊线统计服务）

## 打包步骤

### 方法1：使用打包脚本（推荐）

```bash
# 打包所有服务
./build.sh

# 或者只打包特定服务
./build.sh --manager-only        # 只打包管理器
./build.sh --service-only        # 只打包实时检测服务
./build.sh --line-crossing-only  # 只打包绊线统计服务
```

### 方法2：手动打包

```bash
# 打包管理器
pyinstaller --clean build_manager.spec

# 打包实时检测服务
pyinstaller --clean build_service.spec

# 打包绊线统计服务
pyinstaller --clean build_line_crossing.spec
```

## 打包后的目录结构

打包完成后，`dist/` 目录应该包含：

```
dist/
├── algorithm_manager              # 管理器可执行文件
├── algorithm_service              # 实时检测服务可执行文件
├── algorithm_service_line_crossing # 绊线统计服务可执行文件
├── configs/                       # 配置文件目录
├── logs/                          # 日志目录（运行时创建）
└── weight/                        # 模型文件目录（需要手动放置）
    └── best.om                    # 模型文件
```

## 自动检测机制

代码已经修改为自动检测打包后的环境：
- 如果存在可执行文件（如 `algorithm_service`），则使用可执行文件
- 如果不存在，则回退到使用 Python 脚本（开发环境）

## 注意事项

1. **所有可执行文件必须在同一目录**：`algorithm_manager`、`algorithm_service`、`algorithm_service_line_crossing` 必须在同一个目录下
2. **模型文件需要手动放置**：`weight/best.om` 需要放在可执行文件同级目录下
3. **配置文件已包含**：`configs/` 目录会随打包一起包含
4. **日志目录自动创建**：`logs/` 目录会在运行时自动创建

## 验证打包

打包完成后，检查 `dist/` 目录：

```bash
cd dist
ls -lh algorithm_*
```

应该看到三个可执行文件，都有执行权限。

## 运行测试

```bash
cd dist
./algorithm_manager
```

然后在浏览器中访问 `http://localhost:7900`，尝试启动服务实例。

