# 端口配置说明

## 📋 端口分配

所有服务的端口已统一规划：

| 服务 | 端口 | 说明 |
|------|------|------|
| **Web管理界面** | **7901** | 算法服务管理器（推荐使用） |
| **实时检测服务** | **7902** | 人数统计、客流分析、人头检测 |
| **绊线统计服务** | **7903** | 绊线人数统计 |

---

## 🚀 快速启动

### 启动Web管理界面
```bash
./start_manager.sh
# 访问: http://localhost:7901
```

### 启动实时检测服务
```bash
./start_algorithm_service.sh
# 服务端口: 7902
```

### 启动绊线统计服务
```bash
./start_line_crossing_service.sh
# 服务端口: 7903
```

---

## 🔧 自定义端口

### 通过命令行参数修改

```bash
# 实时检测服务使用端口9000
./start_algorithm_service.sh --port 9000

# 绊线统计服务使用端口9001
./start_line_crossing_service.sh --port 9001
```

### 通过Web界面修改

1. 访问 http://localhost:8901
2. 在服务卡片中修改"端口"输入框
3. 点击"▶️ 启动服务"

---

## ⚠️ 注意事项

### 端口冲突检测
```bash
# 检查端口是否被占用
netstat -tulpn | grep 7901
netstat -tulpn | grep 7902
netstat -tulpn | grep 7903

# 或使用 lsof
lsof -i:7901
lsof -i:7902
lsof -i:7903
```

### 防火墙配置
```bash
# Ubuntu/Debian
sudo ufw allow 7901/tcp  # Web管理界面
sudo ufw allow 7902/tcp  # 实时检测服务
sudo ufw allow 7903/tcp  # 绊线统计服务

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=7901/tcp
sudo firewall-cmd --permanent --add-port=7902/tcp
sudo firewall-cmd --permanent --add-port=7903/tcp
sudo firewall-cmd --reload
```

---

## 🌐 访问地址

### Web管理界面
- 本地访问: http://localhost:7901
- 局域网访问: http://<服务器IP>:7901

### 实时检测服务
- API端点: http://localhost:7902/infer
- 健康检查: http://localhost:7902/health
- 服务信息: http://localhost:7902/

### 绊线统计服务
- API端点: http://localhost:7903/infer
- 健康检查: http://localhost:7903/health
- 服务信息: http://localhost:7903/

---

## 📊 完整配置示例

```bash
# 方案1：使用默认端口
./start_manager.sh                    # 7901
./start_algorithm_service.sh          # 7902
./start_line_crossing_service.sh      # 7903

# 方案2：自定义端口
./start_algorithm_service.sh --port 9000
./start_line_crossing_service.sh --port 9001
# Web界面仍使用8901

# 方案3：完全自定义
./start_algorithm_service.sh --port 9000 --gpu-id 0
./start_line_crossing_service.sh --port 9001 --gpu-id 1
```

---

## 🎯 端口规划理由

| 端口 | 服务 | 理由 |
|------|------|------|
| 7901 | Web管理界面 | 管理入口，便于记忆 |
| 7902 | 实时检测服务 | 常用服务，紧随管理界面 |
| 7903 | 绊线统计服务 | 专用功能，独立端口 |

端口连续分配，便于管理和防火墙配置。

---

## 🔍 验证端口配置

### 检查服务是否启动
```bash
# 检查所有服务
curl http://localhost:7901  # Web管理界面
curl http://localhost:7902/health  # 实时检测服务
curl http://localhost:7903/health  # 绊线统计服务
```

### 查看监听端口
```bash
# 查看所有监听的7900系列端口
netstat -tulpn | grep 790
```

---

Happy managing! 🎉

