# ç»Šçº¿å‘Šè­¦è°ƒè¯•è¯´æ˜

## é—®é¢˜è¯Šæ–­

å¦‚æœç»Šçº¿ç»Ÿè®¡æœåŠ¡æ²¡æœ‰ä¸Šä¼ å‘Šè­¦ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

---

## ğŸ” æ­¥éª¤1ï¼šæ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ

```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep algorithm_service_line_crossing

# æ£€æŸ¥ç«¯å£
curl http://localhost:7903/health

# åº”è¯¥è¿”å›ï¼š
# {"status": "healthy", ...}
```

---

## ğŸ” æ­¥éª¤2ï¼šæŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f /cv_space/predict/logs/line_crossing.log

# æˆ–é€šè¿‡Webç•Œé¢æŸ¥çœ‹
# http://localhost:7901
# é€‰æ‹©"ç»Šçº¿ç»Ÿè®¡æ—¥å¿—"
```

**å…³é”®æ—¥å¿—ä¿¡æ¯ï¼š**
```
âœ“ æ£€æµ‹åˆ°æ–°ç©¿è¶Š: 0 â†’ 1 (+1)ï¼Œè§¦å‘å‘Šè­¦  â† åº”è¯¥çœ‹åˆ°è¿™ä¸ª
   è¿”å›ç»“æœ: total_count=2, person_count=1

â„¹ï¸  æ— æ–°ç©¿è¶Šï¼ˆç´¯è®¡=1ï¼‰ï¼Œä¸è§¦å‘å‘Šè­¦ä½†ä¿ç•™æ£€æµ‹ä¿¡æ¯  â† æˆ–è¿™ä¸ª
   è¿”å›ç»“æœ: total_count=2, æ— person_count
```

---

## ğŸ” æ­¥éª¤3ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶

ç»Šçº¿ç»Ÿè®¡**å¿…é¡»**æœ‰ `algo_config.json` é…ç½®æ–‡ä»¶ã€‚

**æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š**
```bash
# æŸ¥çœ‹å·²ä¿å­˜çš„é…ç½®
ls -l /cv_space/predict/configs/*_algo_config.json

# æŸ¥çœ‹é…ç½®å†…å®¹
cat /cv_space/predict/configs/å•æ‰€ç»Ÿè®¡_algo_config.json
```

**é…ç½®æ–‡ä»¶è¦æ±‚ï¼š**
```json
{
  "task_id": "é—¨ç¦ç»Ÿè®¡",
  "task_type": "ç»Šçº¿äººæ•°ç»Ÿè®¡",  â† å¿…é¡»æ˜¯è¿™ä¸ª
  "regions": [
    {
      "id": "line_1",
      "type": "line",          â† å¿…é¡»æ˜¯ line
      "enabled": true,
      "points": [[0.5, 0], [0.5, 1]],
      "properties": {
        "direction": "both"    â† in/out/both
      }
    }
  ]
}
```

---

## ğŸ” æ­¥éª¤4ï¼šç†è§£å‘Šè­¦é€»è¾‘

### å½“å‰å‘Šè­¦æœºåˆ¶ï¼ˆå¢é‡å‘Šè­¦ï¼‰

```
æ—¶åˆ» T1: æœ‰äººä½†æœªç©¿è¶Š â†’ total_count=2, æ— person_count â†’ ä¸Šæ¸¸çœ‹åˆ°æ£€æµ‹ä½†ä¸å‘Šè­¦
æ—¶åˆ» T2: 1äººç©¿è¶Šç»Šçº¿  â†’ total_count=2, person_count=1  â†’ ä¸Šæ¸¸è§¦å‘å‘Šè­¦ âœ…
æ—¶åˆ» T3: æœ‰äººä½†æœªç©¿è¶Š â†’ total_count=2, æ— person_count â†’ ä¸Šæ¸¸çœ‹åˆ°æ£€æµ‹ä½†ä¸å‘Šè­¦
æ—¶åˆ» T4: 2äººç©¿è¶Šç»Šçº¿  â†’ total_count=3, person_count=2  â†’ ä¸Šæ¸¸è§¦å‘å‘Šè­¦ âœ…
```

**å…³é”®ç‚¹ï¼š**
- âœ… å§‹ç»ˆè¿”å›æ£€æµ‹ä¿¡æ¯ï¼ˆtotal_count, objectsï¼‰
- âœ… åªæœ‰æ–°ç©¿è¶Šæ—¶æ‰è®¾ç½® person_count
- âœ… person_count çš„å­˜åœ¨ä¸å¦å†³å®šæ˜¯å¦è§¦å‘å‘Šè­¦

---

## ğŸ” æ­¥éª¤5ï¼šæ‰‹åŠ¨æµ‹è¯•

### å‘é€æµ‹è¯•è¯·æ±‚

```bash
# å‘é€æ¨ç†è¯·æ±‚
curl -X POST http://localhost:7903/infer \
  -H "Content-Type: application/json" \
  -d '{
    "image_url": "http://10.1.6.230:9000/images/ç»Šçº¿äººæ•°ç»Ÿè®¡/å•æ‰€ç»Ÿè®¡/test.jpg",
    "task_id": "å•æ‰€ç»Ÿè®¡",
    "task_type": "ç»Šçº¿äººæ•°ç»Ÿè®¡"
  }'
```

**é¢„æœŸè¿”å›ï¼ˆæœ‰æ–°ç©¿è¶Šï¼‰ï¼š**
```json
{
  "success": true,
  "result": {
    "objects": [...],
    "total_count": 2,
    "person_count": 1,  â† æœ‰è¿™ä¸ªå­—æ®µ
    "line_crossing": {
      "line_1": {"count": 15}
    }
  }
}
```

**é¢„æœŸè¿”å›ï¼ˆæ— æ–°ç©¿è¶Šï¼‰ï¼š**
```json
{
  "success": true,
  "result": {
    "objects": [...],
    "total_count": 2,
    // æ—  person_count å­—æ®µ
    "line_crossing": {
      "line_1": {"count": 15}
    }
  }
}
```

---

## ğŸ” æ­¥éª¤6ï¼šæ£€æŸ¥ä¸Šæ¸¸ç³»ç»Ÿ

### ä¸Šæ¸¸ç³»ç»Ÿåº”è¯¥å¦‚ä½•åˆ¤æ–­å‘Šè­¦ï¼Ÿ

```python
# ä¸Šæ¸¸ç³»ç»Ÿåˆ¤æ–­é€»è¾‘ï¼ˆä¼ªä»£ç ï¼‰
response = call_algorithm_service(image_url)

if response['success']:
    result = response['result']
    
    # æ–¹å¼1ï¼šæ ¹æ® person_count åˆ¤æ–­ï¼ˆæ¨èï¼‰
    if 'person_count' in result and result['person_count'] > 0:
        trigger_alarm(result['person_count'])  # è§¦å‘å‘Šè­¦
    
    # æ–¹å¼2ï¼šæ ¹æ® total_count åˆ¤æ–­ï¼ˆä¸æ¨èç”¨äºç»Šçº¿ï¼‰
    if result['total_count'] > 0:
        # è¿™ä¸ªä¼šä¸€ç›´è§¦å‘å‘Šè­¦ï¼Œä¸é€‚åˆç»Šçº¿ç»Ÿè®¡
        trigger_alarm(result['total_count'])
```

**å…³é”®ï¼šä¸Šæ¸¸ç³»ç»Ÿéœ€è¦æ£€æŸ¥ `person_count` å­—æ®µæ˜¯å¦å­˜åœ¨ï¼**

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸€ç›´æ˜¾ç¤º"æ— æ–°ç©¿è¶Š"ï¼Ÿ

**å¯èƒ½åŸå› ï¼š**
1. æ²¡æœ‰äººçœŸçš„ç©¿è¶Šç»Šçº¿
2. è·Ÿè¸ªå™¨æ²¡æœ‰æ­£ç¡®å·¥ä½œ
3. ç»Šçº¿ä½ç½®é…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æŸ¥çœ‹æ—¥å¿—ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è·Ÿè¸ªå™¨
grep "è·Ÿè¸ªå™¨æ›´æ–°" /cv_space/predict/logs/line_crossing.log

# æŸ¥çœ‹æ˜¯å¦æœ‰ç»Šçº¿æ£€æµ‹
grep "ç»Šçº¿æ£€æµ‹\|åæ ‡è½¬æ¢" /cv_space/predict/logs/line_crossing.log

# æŸ¥çœ‹ç´¯ç§¯è®¡æ•°
grep "ç´¯åŠ " /cv_space/predict/logs/line_crossing.log
```

---

### Q2: person_count ä¸€ç›´æ˜¯0ï¼Ÿ

**æ£€æŸ¥è¿”å›ç»“æœä¸­æ˜¯å¦æœ‰ person_count å­—æ®µï¼š**
```bash
# æŸ¥çœ‹æ—¥å¿—
grep "è¿”å›ç»“æœ" /cv_space/predict/logs/line_crossing.log | tail -10
```

å¦‚æœçœ‹åˆ°ï¼š
- `è¿”å›ç»“æœ: total_count=2, person_count=1` â† æ­£å¸¸ï¼Œæœ‰å‘Šè­¦
- `è¿”å›ç»“æœ: total_count=2, æ— person_count` â† æ­£å¸¸ï¼Œæ— æ–°ç©¿è¶Š

å¦‚æœå®Œå…¨æ²¡æœ‰ person_count å­—æ®µï¼Œè¯´æ˜æ²¡æœ‰æ£€æµ‹åˆ°æ–°ç©¿è¶Šã€‚

---

### Q3: ç´¯ç§¯è®¡æ•°ä¸å¢é•¿ï¼Ÿ

**æ£€æŸ¥ç»Šçº¿æ£€æµ‹é€»è¾‘ï¼š**
```bash
# æŸ¥çœ‹ç»Šçº¿ç»Ÿè®¡æ—¥å¿—
grep "ç»Šçº¿ç»Ÿè®¡.*è·¨çº¿" /cv_space/predict/logs/line_crossing.log

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# [ç»Šçº¿ç»Ÿè®¡] ID:123 è·¨çº¿ line_1 (in) -> ç´¯åŠ : 15
```

å¦‚æœæ²¡æœ‰è¿™ä¸ªæ—¥å¿—ï¼Œè¯´æ˜ï¼š
1. æ²¡æœ‰äººç©¿è¶Šç»Šçº¿
2. ç»Šçº¿ä½ç½®é…ç½®ä¸æ­£ç¡®
3. è·Ÿè¸ªå™¨æ²¡æœ‰æ­£ç¡®è¿½è¸ªç›®æ ‡

---

### Q4: å¦‚ä½•é‡ç½®ç´¯ç§¯è®¡æ•°ï¼Ÿ

ç´¯ç§¯è®¡æ•°ä¼šåœ¨ä»¥ä¸‹æƒ…å†µé‡ç½®ï¼š
1. æœåŠ¡é‡å¯
2. 24å°æ—¶è‡ªåŠ¨æ¸…é›¶
3. æ‰‹åŠ¨é‡å¯æœåŠ¡

```bash
# é‡å¯ç»Šçº¿æœåŠ¡ï¼ˆé‡ç½®ç´¯ç§¯è®¡æ•°ï¼‰
./åœæ­¢æ‰€æœ‰æœåŠ¡.sh
./start_line_crossing_service.sh
```

---

## ğŸ“Š è°ƒè¯•æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆç«¯å£ 7903ï¼‰
- [ ] é…ç½®æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- [ ] task_type æ˜¯ "ç»Šçº¿äººæ•°ç»Ÿè®¡"
- [ ] regions ä¸­æœ‰ type="line" çš„é…ç½®
- [ ] æ£€æµ‹åˆ°ç‰©ä½“ï¼ˆobjects ä¸ä¸ºç©ºï¼‰
- [ ] è·Ÿè¸ªå™¨æ­£åœ¨å·¥ä½œï¼ˆæ—¥å¿—ä¸­æœ‰"è·Ÿè¸ªå™¨æ›´æ–°"ï¼‰
- [ ] ç»Šçº¿ä½ç½®é…ç½®åˆç†
- [ ] æœ‰äººçœŸçš„ç©¿è¶Šäº†ç»Šçº¿
- [ ] ä¸Šæ¸¸ç³»ç»Ÿæ­£ç¡®å¤„ç† person_count å­—æ®µ

---

## ğŸ”§ å¼ºåˆ¶è§¦å‘å‘Šè­¦æµ‹è¯•

### æ–¹æ³•1ï¼šé‡å¯æœåŠ¡é‡ç½®è®¡æ•°

```bash
# 1. åœæ­¢æœåŠ¡
./åœæ­¢æ‰€æœ‰æœåŠ¡.sh

# 2. é‡æ–°å¯åŠ¨
./start_line_crossing_service.sh

# 3. å‘é€è¯·æ±‚
# ç¬¬ä¸€æ¬¡æœ‰äººç©¿è¶Šä¸€å®šä¼šè§¦å‘å‘Šè­¦ï¼ˆå› ä¸ºè®¡æ•°ä»0å˜æˆ1ï¼‰
```

### æ–¹æ³•2ï¼šä¿®æ”¹ä»£ç ä¸´æ—¶è°ƒè¯•

åœ¨ `algorithm_service_line_crossing.py` ä¸­ä¸´æ—¶æ·»åŠ ï¼š

```python
# åœ¨æ£€æµ‹åˆ°ç©¿è¶Šåï¼Œå¼ºåˆ¶è§¦å‘å‘Šè­¦
if total_crossed >= 0:  # æ€»æ˜¯ä¸ºTrue
    result_data['person_count'] = 1  # å¼ºåˆ¶è®¾ç½®
    print(f"  ğŸ”§ è°ƒè¯•æ¨¡å¼ï¼šå¼ºåˆ¶è§¦å‘å‘Šè­¦")
```

---

## ğŸ“ å®Œæ•´è°ƒè¯•æµç¨‹

```bash
# 1. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
curl http://localhost:7903/health

# 2. æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -50 /cv_space/predict/logs/line_crossing.log

# 3. æœç´¢å…³é”®ä¿¡æ¯
grep -E "æ£€æµ‹åˆ°æ–°ç©¿è¶Š|æ— æ–°ç©¿è¶Š|è¿”å›ç»“æœ" /cv_space/predict/logs/line_crossing.log | tail -20

# 4. æ£€æŸ¥é…ç½®æ–‡ä»¶
ls -l /cv_space/predict/configs/

# 5. å‘é€æµ‹è¯•è¯·æ±‚å¹¶æŸ¥çœ‹è¿”å›
curl -X POST http://localhost:7903/infer -H "Content-Type: application/json" -d '...'

# 6. å¦‚æœä»æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./manage_logs.sh view line
```

---

## ğŸ’¡ é¢„æœŸæ—¥å¿—è¾“å‡º

### æ­£å¸¸å·¥ä½œæ—¶çš„æ—¥å¿—

```
æ”¶åˆ°æ¨ç†è¯·æ±‚ [14:30:15]
  ä»»åŠ¡ID: å•æ‰€ç»Ÿè®¡
  ä»»åŠ¡ç±»å‹: ç»Šçº¿äººæ•°ç»Ÿè®¡
  ğŸ” å°è¯•åŠ è½½é…ç½®æ–‡ä»¶: http://...
  âœ“ æˆåŠŸåŠ è½½é…ç½®æ–‡ä»¶
  ğŸ“‹ é…ç½®å†…å®¹: task_id=å•æ‰€ç»Ÿè®¡, regions=1
  
æ‰¹é‡æ¨ç†å®Œæˆ: 27ms
  [ç»Šçº¿æ£€æµ‹] åæ ‡è½¬æ¢: [0.4, 0.1] -> (768, 108), [0.4, 0.9] -> (768, 972)
  [ç»Šçº¿ç»Ÿè®¡] ID:5 è·¨çº¿ line_1 (in) -> ç´¯åŠ : 15
  
  âœ“ æ£€æµ‹åˆ°æ–°ç©¿è¶Š: 14 â†’ 15 (+1)ï¼Œè§¦å‘å‘Šè­¦
     è¿”å›ç»“æœ: total_count=2, person_count=1  â† å…³é”®ï¼
  
æ¨ç†å®Œæˆ: æ€»è€—æ—¶ 60ms
```

---

Happy debugging! ğŸ”§

